var floral_redux={};!function(e){"use strict";jQuery.fn.selectText=function(){var e=document,t=this[0];if(e.body.createTextRange)(n=document.body.createTextRange()).moveToElementText(t),n.select();else if(window.getSelection){var a=window.getSelection(),n=document.createRange();n.selectNodeContents(t),a.removeAllRanges(),a.addRange(n)}},floral_redux={on_ready:function(){floral_redux.do_options_preset_management()},do_options_preset_management:function(){function t(){s.fadeIn(),i.find(".spinner").addClass("is-active"),i.find("input").attr("disabled","disabled"),c.find(".create-preset, .options-preset-select").attr("disabled","disabled")}function a(){s.fadeOut(),i.find(".spinner").css("visibility","hidden"),i.find("input").prop("disabled",!1),c.find(".create-preset, .options-preset-select").prop("disabled",!1)}function n(){o.find(".admin-notice").slideUp(),o.find(".preset_created_success").slideDown()}function r(e){o.find(".admin-notice").slideUp(),"success"==e?o.find(".action-success").slideDown().delay(4e3).slideUp():"error"==e?o.find(".action-error").slideDown().delay(4e3).slideUp():"success-redirect"==e&&o.find(".action-success-redirect").slideDown().delay(4e3).slideUp()}var s=e("#redux_ajax_overlay"),i=e(".redux-action_bar"),o=e("#redux_notification_bar"),c=e(".floral-preset-management");!function(){o.find(".preset_switched_notice").slideDown().delay(4e3).slideUp()}(),function(){c.each(function(){var a=e(this).find("select.options-preset-select"),n=a.val();a.on("change",function(e){e.preventDefault();var r=a.val();r!==n&&(t(),window.open(r,"_self"))})})}(),function(){function n(e,a){t(),e.find("i").removeClass(a).addClass("fa-spinner fa-spin")}function s(e,t){a(),e.find("i").removeClass("fa-spinner fa-spin").addClass(t)}function i(){d.prop("contenteditable",!1),d.css("text-transform","uppercase"),d.text(g)}var o=e(".floral_redux-current-preset"),l=c.find("a.global-preset-title"),d=o.find("h3.current-preset"),f=o.find(".action-edit"),p=o.find(".action-make-global"),u=o.find(".action-remove");p.on("click",function(t){t.preventDefault();var a=e(this);n(a,"fa-globe");var i={action:"do_make_global_preset",preset_name:d.attr("data-current-preset")};e.ajax({type:"GET",data:i,url:floral_main_admin_vars.ajax_url,success:function(t){try{(t=e.parseJSON(t)).status?(l.text(d.text()),r("success"),a.fadeOut().parents(".hint").remove()):r("error")}catch(e){r("error")}},error:function(){r("error")},complete:function(){s(a,"fa-globe")}})}),u.on("click",function(t){t.preventDefault();var a=e(this);if(confirm(floral_redux_extend_vars.confirm_remove_preset_message)){n(a,"fa-trash-o");var i={action:"do_remove_preset",preset_name:d.attr("data-current-preset")};e.ajax({type:"GET",data:i,url:floral_main_admin_vars.ajax_url,success:function(t){try{(t=e.parseJSON(t)).status?t.redirect?(r("success-redirect"),window.open(t.redirect,"_self")):r("success"):(r("error"),s(a,"fa-trash-o"))}catch(e){r("error"),s(a,"fa-trash-o")}},error:function(){r("error"),s(a,"fa-trash-o")}})}});var g=d.text().trim();d.on("save-preset-name",function(){var t=e(this);if(t.text().trim()!=g){n(f,"fa-save fa-edit");var a={action:"do_change_preset_title",preset_title:t.text().trim(),preset_name:t.attr("data-current-preset")};e.ajax({type:"GET",data:a,url:floral_main_admin_vars.ajax_url,success:function(t){try{(t=e.parseJSON(t)).status?(r("success-redirect"),window.location.reload(!0)):(r("error"),i(),s(f,"fa-edit"))}catch(e){r("error"),i(),s(f,"fa-edit")}},error:function(e){r("error"),i(),s(f,"fa-edit")}})}else f.effect("shake",500)}),d.on("keypress",function(t){var a=String.fromCharCode(t.which);return 13==t.which?(e(this).trigger("save-preset-name"),!1):!!a.match(/[\sA-Za-z0-9_-]/)&&!(e(this).text().trim().length>30)&&void 0}),e(document).on("click",function(t){0==e(t.target).closest(".action-edit").length&&0==e(t.target).closest("h3.current-preset").length&&f.find("i").hasClass("fa-save")&&(i(),f.find("i").removeClass("fa-save").addClass("fa-edit"))}),f.on("click",function(t){t.preventDefault();var a=e(this).find("i");a.hasClass("fa-edit")?(d.prop("contenteditable",!0),d.css("text-transform","inherit"),d.trigger("focus").selectText(),a.removeClass("fa-edit").addClass("fa-save")):a.hasClass("fa-save")&&d.trigger("save-preset-name")})}(),function(){function a(){p.fadeIn();var a=o.val().trim(),r=d.val(),i=f.is(":checked");if(a.length<1)s.trigger("invalid-input",floral_redux_extend_vars.validation_error_message),p.fadeOut();else{var c={action:"do_create_preset",preset_title:a,preset_clone:r,preset_edit:i};e.ajax({type:"POST",url:floral_main_admin_vars.ajax_url,data:c,success:function(a){try{switch((a=e.parseJSON(a)).status){case"validation-error":a.message?s.trigger("invalid-input",a.message,!0):s.trigger("invalid-input",floral_redux_extend_vars.validation_error_message,!0);break;case"success":s.dialog("close"),n(),t(),window.location.reload(!0);break;case"edit":s.dialog("close"),t(),n(),window.open(a.message,"_self")}}catch(e){s.trigger("invalid-input",e,!1)}},error:function(e){s.trigger("invalid-input",e,!1)},complete:function(){p.fadeOut()}})}}var r=e("body"),s=r.find(".floral-preset-form-wrapper");if(0==s.length){var i=e("#template-create-preset");r.append(i.html()),s=r.find(".floral-preset-form-wrapper")}var o=s.find("input.preset-title"),l=o.attr("placeholder"),d=s.find("select.preset-clone"),f=s.find("input.preset-edit"),p=s.find(".block-loading");!function(){s.dialog({autoOpen:!1,modal:!0,width:500,height:340,resizable:!1,buttons:[{text:"Create preset",click:function(){s.find(".message").remove(),a()},class:"ui-button-primary"},{text:"Cancel",click:function(){e(this).dialog("close")}}]}),s.on("invalid-input",function(t,a,n){e(this).parent(".ui-dialog").effect("shake",500),1==n&&o.addClass("validate-error"),a?s.append(a):s.append(floral_redux_extend_vars.error_message)}),d.select2({width:"100%"}),o.on("keypress",function(t){return!!String.fromCharCode(t.which).match(/[\sA-Za-z0-9_+-]/)&&!(e(this).text().trim().length>30)&&void 0}).on("focus",function(){e(this).hasClass("validate-error")&&(e(this).removeClass("validate-error"),e(this).attr("placeholder",l))})}(),function(){c.on("click","button.create-preset",function(e){e.preventDefault(),s.find(".message").remove(),s.dialog("open")})}()}(),function(){i.each(function(){var t=e(this);"true"==t.attr("data-trigger-auto-save")&&t.find("#button-generate-css").trigger("click")})}()},do_init_generate_css_action:function(){e("button.floral-btn-generate-presets-css").each(function(){function t(){var e=r.attr("data-in-process");return!("false"==e||0==e||""==e||void 0===e)}function a(){r.attr("data-in-process","true"),r.addClass("disabled"),s.css("display","block"),i.find(".spinner").css("visibility","visible"),i.find("input").attr("disabled","disabled"),r.parent().find(".logging").remove()}function n(){r.attr("data-in-process","false"),r.removeClass("disabled"),s.css("display","none"),i.find(".spinner").css("visibility","hidden"),i.find("input").prop("disabled",!1)}var r=e(this),s=e("#redux_ajax_overlay"),i=e(".redux-action_bar"),o=r.parent().find(".logging-panel");r.on("click",function(r){if(r.preventDefault(),!t()){a();var s={action:"do_regenerate_presets_css"};e.ajax({type:"GET",data:s,url:ajaxurl,success:function(t){try{t=e.parseJSON(t),console.log(t),o.append('<span class="logging" style="color:green">STATUS: '+t.status+"</span>"),o.append('<span class="logging" style="color:green">SUCCESS COLORS: '+t.message.success+"</span>"),o.append('<span class="logging" style="color:red">FAIL COLORS: '+t.message.fail+"</span>"),o.append('<span class="logging" style="color:blue">TIME: '+t.time+"(ms) </span>")}catch(e){o.append('<span class="logging" style="color:red">PARSING ERROR: '+e+"</span>")}},error:function(e){o.append('<span class="logging" style="color:red">ERROR: '+e+"</span>")},complete:function(){n()}})}})})}},e(document).ready(function(){floral_redux.on_ready()})}(jQuery);